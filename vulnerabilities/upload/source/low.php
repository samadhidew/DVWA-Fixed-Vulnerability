
<?php

if (isset($_POST['Upload'])) {
    // Where are we going to be writing to?
    $target_directory = DVWA_WEB_PAGE_TO_ROOT . "hackable/uploads/";

    // Check if the file upload field is set and not empty
    if (isset($_FILES['uploaded']) && !empty($_FILES['uploaded']['name'])) {
        // Get the uploaded file's name
        $uploaded_filename = basename($_FILES['uploaded']['name']);

        // Generate a unique filename to prevent overwriting existing files
        $unique_filename = uniqid() . '_' . $uploaded_filename;

        // Target path for the uploaded file
        $target_path = $target_directory . $unique_filename;

        // Check if the uploaded file is a valid image file (you can adjust the allowed file types)
        $allowed_extensions = array("jpg", "jpeg", "png", "gif");
        $uploaded_extension = strtolower(pathinfo($uploaded_filename, PATHINFO_EXTENSION));
        if (!in_array($uploaded_extension, $allowed_extensions)) {
            $html .= '<pre>Only JPG, JPEG, PNG, and GIF files are allowed.</pre>';
        } else {
            // Move the uploaded file to the upload directory
            if (move_uploaded_file($_FILES['uploaded']['tmp_name'], $target_path)) {
                // File uploaded successfully
                $html .= "<pre>{$target_path} successfully uploaded!</pre>";
            } else {
                // Failed to move the uploaded file
                $html .= '<pre>Failed to upload the file.</pre>';
            }
        }
    } else {
        // File upload field is not set or empty
        $html .= '<pre>No file uploaded.</pre>';
    }
}

?>
