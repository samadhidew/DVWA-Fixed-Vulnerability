<?php

if (isset($_REQUEST['Submit'])) {
    // Get input
    $id = $_REQUEST['id'];

    switch ($_DVWA['SQLI_DB']) {
        case MYSQL:
            // Check database
            $query = "SELECT first_name, last_name FROM users WHERE user_id = ?";

            // Prepare the SQL statement
            $stmt = mysqli_prepare($GLOBALS["___mysqli_ston"], $query);

            // Bind parameters
            mysqli_stmt_bind_param($stmt, "i", $id);

            // Execute the statement
            mysqli_stmt_execute($stmt);

            // Bind result variables
            mysqli_stmt_bind_result($stmt, $first, $last);

            // Fetch results
            while (mysqli_stmt_fetch($stmt)) {
                // Feedback for end user
                $html .= "<pre>ID: {$id}<br />First name: {$first}<br />Surname: {$last}</pre>";
            }

            // Close statement
            mysqli_stmt_close($stmt);
            mysqli_close($GLOBALS["___mysqli_ston"]);
            break;

        case SQLITE:
            global $sqlite_db_connection;

            // Prepare the SQL statement
            $query = "SELECT first_name, last_name FROM users WHERE user_id = ?";

            // Prepare the SQL statement
            $stmt = $sqlite_db_connection->prepare($query);

            if ($stmt) {
                // Bind parameters
                $stmt->bindParam(1, $id, SQLITE3_INTEGER);

                // Execute the statement
                $result = $stmt->execute();

                if ($result) {
                    // Fetch results
                    while ($row = $result->fetchArray()) {
                        // Get values
                        $first = $row["first_name"];
                        $last = $row["last_name"];

                        // Feedback for end user
                        $html .= "<pre>ID: {$id}<br />First name: {$first}<br />Surname: {$last}</pre>";
                    }
                } else {
                    echo "Error in fetch " . $sqlite_db->lastErrorMsg();
                }
            } else {
                echo "Error in statement preparation";
            }

            break;
    }
}

?>
